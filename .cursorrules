# Instructions

During your interaction with the user, if you find anything reusable in this project (e.g. version of a library, model name), especially about a fix to a mistake you made or a correction you received, you should take note in the `Lessons` section so you will not make the same mistake again.

Use the `.cursorrules` file as a Scratchpad to organize your thoughts. When receiving a new task, review the content, clear old tasks if necessary, explain the current task, and plan steps to complete it. Use todo markers to indicate progress:
[X] Task 1
[ ] Task 2

Update progress in the Scratchpad when finishing subtasks or milestones to maintain a big picture of the task.

# Tools

All tools are in python3. For batch processing, consult the python files and write your own script if needed.

## Screenshot Verification
```bash
venv/bin/python3 tools/screenshot_utils.py URL [--output OUTPUT] [--width WIDTH] [--height HEIGHT]
venv/bin/python3 tools/llm_api.py --prompt "Your verification question" --provider {openai|anthropic} --image path/to/screenshot.png
```

## LLM
```bash
venv/bin/python3 ./tools/llm_api.py --prompt "What is the capital of France?" --provider "anthropic"
```

Supported providers:
- OpenAI (default, model: gpt-4o)
- Azure OpenAI (model: configured via AZURE_OPENAI_MODEL_DEPLOYMENT)
- DeepSeek (model: deepseek-chat)
- Anthropic (model: claude-3-sonnet-20240229)
- Gemini (model: gemini-pro)
- Local LLM (model: Qwen/Qwen2.5-32B-Instruct-AWQ)

## Web browser
```bash
venv/bin/python3 ./tools/web_scraper.py --max-concurrent 3 URL1 URL2 URL3
```

## Search engine
```bash
venv/bin/python3 ./tools/search_engine.py "your search keywords"
```

# Lessons

## User Specified Lessons
- Use python venv in ./venv for development. Check for 'uv' with `which uv`. If available, use `uv pip install`; otherwise, use `pip`.
- For git multiline commit messages, write to a file and use `git commit -F <filename>`. Include "[Cursor] " in commit messages and PR titles.
- The official BTS brand color is #FFDE00 (yellow) and should be used for branded elements instead of purple.
- When customizing Sonner library toast notifications, use standard properties in ExternalToast type and avoid non-standard properties like 'descriptionStyle'.
- For Next.js page layouts, set specific max-width constraints instead of relying on container classes to maintain consistent widths across different screen sizes.
- For image creation in canvas contexts, use `document.createElement('img')` instead of `new Image()` to avoid TypeScript errors.
- Use Unicode escape sequences like `\u201C` (left double quote) and `\u201D` (right double quote) for special characters in TypeScript/JavaScript to avoid syntax and linter errors.
- When deploying to hosting platforms like Netlify or Vercel, ensure that all necessary environment variables (such as Supabase credentials) are configured in the platform's environment settings.
- For mobile-friendly spacing in Next.js layouts, use responsive padding classes (e.g., pt-0 md:pt-8) to reduce space between navbar and content on small screens while maintaining appropriate spacing on larger displays.
- Avoid using console.error in production code; instead, use conditional logging based on NODE_ENV to show detailed errors only in development.
- When implementing SEO in Next.js, metadata cannot be exported from client components (with "use client" directive). For client pages, create a separate metadata.ts file in the same directory.
- For date and time displays that need to work across different user timezones, implement client-side timezone handling using the browser's Date API instead of server-side fixed timezones.
- When working with third-party APIs like Spotify that have rate limits, implement these strategies to prevent 429 errors: 1) Add local caching, 2) Use exponential backoff for retries, 3) Process batch requests sequentially with delays, 4) Add client-side throttling, and 5) Provide clear user feedback during retries.
- When Supabase operations fail with empty error objects `{}`, it usually means the database tables don't exist yet. Always provide helpful error messages that mention "Database tables may not exist. Please run the SQL schema first." instead of just logging the empty error object.

## Cursor learned
- Handle UTF-8 encoding properly for international search queries
- Use 'seaborn-v0_8' instead of 'seaborn' due to recent version changes
- Use 'gpt-4o' as the model name for OpenAI's GPT-4 with vision capabilities
- In Next.js, `dynamic` imports with `{ ssr: false }` cannot be used directly in Server Components. Create a client component wrapper with "use client" that handles the dynamic import.
- For React 19 compatibility issues with packages like react-day-picker, use --legacy-peer-deps or downgrade to React 18.2.0
- When renaming React component functions, maintain backward compatibility with additional named exports
- In Next.js sitemap.ts files, use 'as const' type assertion for changeFrequency values to match the expected literal types in MetadataRoute.Sitemap
- In Next.js projects with aliased imports (@/hooks, @/components), make sure to maintain proper directory structures and use re-export files to maintain backward compatibility when refactoring.

## Message Box UI Pattern
- Container: White background, black border (2px), rounded corners (16px)
- Heading: "Black Han Sans" font, ~32px, black, center-aligned
- Form Layout: Vertical stack with ~16-20px spacing
- Input Fields: Black border (2px), white background, rounded corners (8px), padding (12px)
- Submit Button: Black background, yellow text (#FFDE00), purple heart emoji, full width, rounded (8px)
- Labels: Bold, black text, slightly larger than input text
- Textarea: Taller than regular inputs, same styling pattern

# Scratchpad

## Current Task: Enhanced Purple Hearts Collector Game with BTS Members & Leaderboard

### Task Description
Enhance the Purple Hearts Collector game to include:
1. ✅ Name input before playing (like Whack-a-Mole)
2. ✅ BTS member heads as collectible items for bonus points
3. ✅ Leaderboard system with Supabase integration
4. ✅ Social sharing functionality
5. [ ] Complete game mechanics with spawn/collect functions
6. [ ] Responsive UI for all devices
7. [ ] Enhanced visual effects and animations

### Progress Made

#### Database & Infrastructure
- ✅ Created Supabase schema for purple_hearts_scores table
- ✅ Built supabase-purple-hearts.ts service functions
- ✅ Created PurpleHeartsLeaderboard component
- ✅ Created PurpleHeartsSocialShare component
- ✅ Updated documentation with new SQL schema

#### Game Component Structure
- ✅ Enhanced interfaces for FallingItem, BTSMember, GameStats
- ✅ Added BTS_MEMBERS data with head images and abilities
- ✅ Complete component state management (name input, menu, playing, gameOver, etc.)
- ✅ Score saving and leaderboard integration functions
- ✅ Game timer and navigation functions
- ✅ Item spawning and physics system
- ✅ Collection logic with member abilities
- ✅ Visual effects (confetti, hit effects, level-up animations)
- ✅ Responsive UI for all screen sizes

#### Still Needed
- [X] Complete game mechanics (spawn items, collect logic, physics)
- [X] UI screens (name input, menu, game area, game over)
- [X] BTS member abilities and special effects
- [X] Enhanced visual effects and animations
- [X] Mobile responsiveness optimization
- [X] Testing and polish
- [X] Fixed member spawning bug (all 7 BTS members now appear properly)

### BTS Members & Abilities
1. **RM** (Common, 15pts): Leader Power +5 bonus
2. **Jin** (Common, 15pts): Longer fall time
3. **Suga** (Rare, 20pts): Double points when caught fast
4. **J-Hope** (Rare, 20pts): +3 bonus to next catch
5. **Jimin** (Rare, 20pts): Graceful bonus multiplier x1.5
6. **V** (Rare, 20pts): Wild card bonus points
7. **Jungkook** (Legendary, 30pts): All bonuses activated

### Technical Notes
- Using head images from `/public/images/members/head/`
- Game duration: 60 seconds
- Level up threshold: 100 points
- Fast catch threshold: 800ms
- Streak bonus threshold: 5 catches